<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آسمان ما</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Tahoma', sans-serif; }
        canvas { display: block; }
        
        /* دکمه شروع */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100;
            display: flex; justify-content: center; align-items: center;
            transition: opacity 1s;
        }
        button {
            padding: 15px 40px; border: 2px solid #00d2ff; color: #00d2ff;
            background: transparent; font-size: 1.5rem; cursor: pointer;
            border-radius: 50px; box-shadow: 0 0 20px rgba(0, 210, 255, 0.4);
            transition: 0.3s;
        }
        button:hover { background: #00d2ff; color: #000; }
        
        .fade-out { opacity: 0; pointer-events: none; }
        
        /* متن پایین صفحه */
        .info {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: rgba(255, 255, 255, 0.5); pointer-events: none;
            font-size: 12px;
        }
    </style>
</head>
<body>

    <div id="overlay">
        <button id="startBtn">نمایش آسمان شب ما</button>
    </div>
    
    <div class="info">Mashhad - Jan 22, 2024 - The Night We Looked Up</div>
    <canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    // --- تنظیمات ---
    const CONFIG = {
        heartColor: '#ff0066', // رنگ قلب
        starColor: '#ffffff',  // رنگ ستاره‌ها
        lineColor: 'rgba(255, 255, 255, 0.15)', // رنگ خطوط صور فلکی
        transitionSpeed: 0.03 // سرعت تبدیل
    };

    // --- دیتابیس دقیق صورت فلکی جبار و اطراف (قابل مشاهده در مشهد زمستان) ---
    // x, y are normalized (-1 to 1) relative to Orion
    const STARS = [
        // Orion (شکارچی)
        { id: 'betelgeuse', x: -0.2, y: -0.2, size: 3.5, color: '#ffcc99' }, // Betelgeuse (Red)
        { id: 'rigel', x: 0.25, y: 0.4, size: 3.5, color: '#99ccff' },     // Rigel (Blue)
        { id: 'bellatrix', x: 0.2, y: -0.15, size: 2.5 },
        { id: 'saiph', x: -0.15, y: 0.45, size: 2.5 },
        { id: 'belt1', x: -0.05, y: 0.1, size: 2.2 }, // Alnitak
        { id: 'belt2', x: 0.0, y: 0.08, size: 2.2 },  // Alnilam
        { id: 'belt3', x: 0.05, y: 0.06, size: 2.2 }, // Mintaka
        // Sirius (پرنورترین ستاره آسمان - پایین چپ جبار)
        { id: 'sirius', x: -0.6, y: 0.7, size: 4.5, color: '#ffffff' },
        // Aldebaran (چشم گاو - بالا راست جبار)
        { id: 'aldebaran', x: 0.7, y: -0.4, size: 3.0, color: '#ffcc00' },
        // Procyon
        { id: 'procyon', x: -0.7, y: -0.1, size: 2.8 },
        // Castor & Pollux (دوپیکر)
        { id: 'pollux', x: -0.5, y: -0.7, size: 2.6 },
        { id: 'castor', x: -0.6, y: -0.65, size: 2.5 },
    ];

    // خطوطی که باید بین ستاره‌ها کشیده بشه
    const CONSTELLATIONS = [
        ['betelgeuse', 'belt1'], ['belt1', 'belt2'], ['belt2', 'belt3'], ['belt3', 'bellatrix'], // Belt area
        ['betelgeuse', 'bellatrix'], // Shoulders
        ['belt1', 'saiph'], ['belt3', 'rigel'], // Legs
        ['betelgeuse', 'procyon'], // Winter Triangle side
        ['sirius', 'betelgeuse']   // Winter Triangle side
    ];

    // پر کردن آسمان با ستاره‌های رندوم برای پس‌زمینه
    for(let i=0; i<300; i++) {
        STARS.push({
            id: 'bg'+i,
            x: (Math.random() - 0.5) * 4,
            y: (Math.random() - 0.5) * 4,
            size: Math.random() * 1.5,
            isBg: true
        });
    }

    let particles = [];
    let state = 'HEART'; // HEART -> MOVING -> SKY
    let opacityLines = 0;
    let shootingStar = null;

    // --- کلاس ذره ---
    class Particle {
        constructor(starDef) {
            this.def = starDef;
            this.x = width / 2;
            this.y = height / 2;
            this.size = starDef.size || 1;
            this.targetX = 0;
            this.targetY = 0;
            this.color = starDef.color || '#ffffff';
            
            this.vx = 0; this.vy = 0;
            this.initHeart();
        }

        initHeart() {
            // فرمول ریاضی قلب
            let t = Math.random() * Math.PI * 2;
            let r = Math.sqrt(Math.random()); // پر کردن داخل قلب
            // فرمول:
            let hx = 16 * Math.pow(Math.sin(t), 3);
            let hy = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
            
            let scale = Math.min(width, height) / 30;
            this.x = (hx * scale * r) + width/2;
            this.y = (hy * scale * r) + height/2;
        }

        update() {
            if (state === 'HEART') {
                // لرزش در حالت قلب
                this.x += (Math.random()-0.5) * 0.5;
                this.y += (Math.random()-0.5) * 0.5;
            } 
            else if (state === 'MOVING' || state === 'SKY') {
                // محاسبه جایگاه نهایی در آسمان
                // مقیاس‌دهی مختصات (زوم کردن روی جبار)
                let skyScale = Math.min(width, height) * 0.6;
                this.targetX = (this.def.x * skyScale) + width/2;
                this.targetY = (this.def.y * skyScale) + height/2;

                // حرکت نرم به سمت هدف
                let dx = this.targetX - this.x;
                let dy = this.targetY - this.y;
                
                this.x += dx * CONFIG.transitionSpeed;
                this.y += dy * CONFIG.transitionSpeed;
            }
        }

        draw() {
            ctx.beginPath();
            ctx.fillStyle = (state === 'HEART' && !this.def.isBg) ? CONFIG.heartColor : this.color;
            
            // چشمک زدن در حالت آسمان
            let alpha = 1;
            if (state === 'SKY') {
                alpha = 0.5 + Math.random() * 0.5;
            }
            
            ctx.globalAlpha = alpha;
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1;
        }
    }

    // --- کلاس شهاب سنگ ---
    class ShootingStar {
        constructor() {
            this.x = Math.random() * width;
            this.y = 0;
            this.len = 0;
            this.speed = 15;
            this.active = true;
        }
        update() {
            this.x -= this.speed;
            this.y += this.speed * 0.8;
            this.len += 2;
            if (this.len > 150) this.len = 150;
            if (this.x < 0 || this.y > height) this.active = false;
        }
        draw() {
            if(!this.active) return;
            let tailX = this.x + this.len;
            let tailY = this.y - this.len * 0.8;
            
            let grad = ctx.createLinearGradient(this.x, this.y, tailX, tailY);
            grad.addColorStop(0, 'white');
            grad.addColorStop(1, 'transparent');
            
            ctx.beginPath();
            ctx.strokeStyle = grad;
            ctx.lineWidth = 3;
            ctx.moveTo(this.x, this.y);
            ctx.lineTo(tailX, tailY);
            ctx.stroke();
            
            // سر شهاب سنگ
            ctx.beginPath();
            ctx.fillStyle = 'white';
            ctx.arc(this.x, this.y, 2, 0, Math.PI*2);
            ctx.fill();
        }
    }

    // --- توابع اصلی ---
    function init() {
        resize();
        STARS.forEach(def => particles.push(new Particle(def)));
        animate();
    }

    function animate() {
        // پس زمینه با ردپای کم (برای افکت حرکت)
        ctx.fillStyle = 'rgba(5, 10, 20, 0.3)';
        ctx.fillRect(0, 0, width, height);

        // رسم خطوط صور فلکی (فقط در حالت آسمان)
        if (state === 'SKY') {
            opacityLines += 0.005;
            if (opacityLines > 1) opacityLines = 1;
            
            ctx.beginPath();
            ctx.strokeStyle = `rgba(255, 255, 255, ${opacityLines * 0.2})`;
            ctx.lineWidth = 1;

            CONSTELLATIONS.forEach(pair => {
                let p1 = particles.find(p => p.def.id === pair[0]);
                let p2 = particles.find(p => p.def.id === pair[1]);
                if (p1 && p2) {
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                }
            });
            ctx.stroke();
        }

        particles.forEach(p => {
            p.update();
            p.draw();
        });

        if (shootingStar) {
            shootingStar.update();
            shootingStar.draw();
        }

        requestAnimationFrame(animate);
    }

    // شروع برنامه با کلیک دکمه
    document.getElementById('startBtn').addEventListener('click', () => {
        document.getElementById('overlay').classList.add('fade-out');
        
        // بعد از 2 ثانیه، قلب تبدیل به آسمان شود
        setTimeout(() => {
            state = 'MOVING';
            // بعد از اینکه ستاره‌ها سر جاشون رسیدن، خطوط رو نشون بده
            setTimeout(() => {
                state = 'SKY';
                // بعد از 2 ثانیه شهاب سنگ بیاد
                setTimeout(() => {
                    shootingStar = new ShootingStar();
                }, 2000);
            }, 3000);
        }, 2000);
    });

    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    
    // اجرا
    init();

</script>
</body>
</html>
